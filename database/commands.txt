use fifa

db.saves.find().forEach(function(save) {
    db.saves.update({ _id: save._id }, { $set: { teams: [] }});
});

db.competitions.find().forEach(function(comp) {
    db.competitions.update({ _id: comp._id }, { $set: { start: new Date(comp.start) }});
});

db.divisions.find().forEach(function(division) {
    comp = db.competitions.findOne({ name: division.competition })._id;
    db.divisions.update({ _id: division._id }, { $set: { competition: comp }});
});

db.teamsins.find().forEach(function(teamsIn) {
    save = db.saves.findOne({ user: "template" })._id;
    comp = db.competitions.findOne({ name: teamsIn.saveId })._id;
    div = db.divisions.findOne({ competition: comp, name: teamsIn.division })._id;
    game = db.games.findOne({ name: teamsIn.game })._id;
    team = db.teams.findOne({ name: teamsIn.team })._id;
    db.teamsins.update(
        { _id: teamsIn._id }, 
        { $set: {
            saveId: save,
            game: game,
            division: div,
            team: team,
            player: false
        }});
});

db.playerdynamicinfos.find().forEach(function(player) {
    db.playerstaticinfos.insert({
        firstName: player.firstName,
        lastName: player.lastName,
        birthDate: new Date(player.birthDate),
        foot: player.foot
    });
    id = db.playerstaticinfos.findOne({
        firstName: player.firstName,
        lastName: player.lastName,
        birthDate: new Date(player.birthDate),
        foot: player.foot })._id;
    team = db.teams.findOne({ name: player.team })._id;
    db.playerfors.insert({
        teamId: team,
        playerId: player._id
    });
    save = db.saves.findOne({ user: "template" });
    db.playerdynamicinfos.update(
        { _id: player._id },
        { $set: { 
            saveId: save,
            playerId: id,
            contractExpiration: new Date(player.contractExpiration)
          },
          $unset: { 
            firstName: "",
            lastName: "",
            birthDate: "",
            foot: ""
          }});
});